-----
-----
<%
# -- init variables --
class LocalConf
    attr_accessor :blog, :article, :languages, :language, :indent
    def to_s
        instance_variables.map{ |x| 
            if instance_variable_get(x).class == Array
                %{#{x.intern}=  [#{instance_variable_get(x).join(', ')}]} 
            else
                %{#{x.intern}=  #{instance_variable_get(x)}} 
            end
        }
    end
end

conf=LocalConf.new

language=@item_rep.path.sub(/\/Scratch\//,'').sub(/\/.*$/,'')
conf.language=language

# the current item is an article
article=( ( not @item[:kind].nil? ) && @item[:kind] == 'article' )
conf.article=article

# the current item is a blog entry page
blog=( ( not @item[:kind].nil? ) && @item[:kind] == 'blog' )
conf.blog=blog

# all supported languages
languages=@config[:languages]
conf.languages=languages

self.instance_variable_set(:@conf, conf)

# puts '--- conf ---'
# puts conf.to_s

    %><?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="shortcut icon" type="image/x-icon" href="/Scratch/img/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="/Scratch/css/twilight.css" />
    <link rel="stylesheet" type="text/css" href="/Scratch/assets/css/layout.css" />
    <link rel="stylesheet" type="text/css" href="/Scratch/css/shadows.css" />
    <link rel="stylesheet" type="text/css" href="/Scratch/assets/css/gen.css" />
    <% if article  %>
    <link rel="stylesheet" type="text/css" href="/Scratch/css/idc.css" />
    <% end %>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/yannespositocom<%= language %>">
    <link rel="stylesheet" type="text/css" href="/Scratch/css/js.css" /> <% 
    languages.each do |lang|
        item_for_lang=item_of_language(lang)
        if not item_for_lang.nil? %>
    <link rel="alternate" lang="<%= lang %>" xml:lang="<%= lang %>" title="<%= item_for_lang[:title] %>" type="text/html" hreflang="<%= lang %>" href="<%= item_for_lang.reps[0].path %>" /> <% 
        end
    end %>
    <script type="text/javascript" src="/Scratch/js/jquery-1.3.1.min.js"></script>
    <script type="text/javascript" src="/Scratch/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/Scratch/js/index.js"></script>
    <noscript>
        <link rel="stylesheet" type="text/css" href="/Scratch/css/nojs.css" />
    </noscript>
    <title><%= @item[:title] %></title>
</head>
<body lang="<%= language %>">
    <script type="text/javascript">
        document.write('<div id="blackpage"><img src="/Scratch/img/loading.gif" alt="<%= tradOf(:loading) %>"/></div>');
    </script>

    <div id="content">
        <div id="entete">
            <div id="rss">
                <span>
                    <a href="http://feeds.feedburner.com/yannespositocom<%= language %>">
                        <%= tradOf(:subscribe) %>
                        <img src="/Scratch/img/menu/rss-128.png" alt="rss" height="32"/>
                    </a>
                    <sup>
                        <a href="/Scratch/multi/rss"><%= tradOf(:whatsthis) %></a>
                    </sup>
                </span>
            </div>
            <div id="choix"> 
                <%= tradOf(:langue) %>
                <div id="choixlang">
                    <ul>
                    <% languages.each do |l| %>
                        <% dest=@item_rep.path.sub(/^\/Scratch\/..\//, %{/Scratch/#{l}/})  %>
                        <% if @item_rep.path != dest %>
                        <li><a href="<%=dest%>" onclick="setLanguage('<%=l%>')"><%= l %></a></li>
                        <% end %>
                    <% end %>
                    </ul>
                </div>
            </div>
            <div id="liens">
            <%= generateMenu %>
            </div>
        </div>

        <div id="titre">
            <h1>
                <%= @item[:title] %>
            </h1>
            <% unless @item[:subtitle].nil? %> 
            <h2>
                <%= @item[:subtitle] %> 
            </h2>
            <% end %>
        </div>

        <div class="flush"></div>

        <% if @item[:content_for_summary] %>
            <div class="corps summary">
                <% @item[:content_for_summary] %>
            </div>
        <% end %>

        <%= generateSubMenu %>
    
        <div class="flush"></div>
        <div id="afterheader">
            <div class="corps">
                <%= yield %>
            </div>
            <% if article  %>
                <% if depthOf(@item) == 3 %>
                <div class="navigation">
                    <%= puts "previousFor(@item)" %>
                    <%= puts "nextFor(@item)" %>
                </div>
                <div class="flush"></div>
                <% end %>

                <div class="corps" id="comment">
                    <h2 class="first"><%= tradOf(:comment) %></h2>
                    <%= generateIntenseDebateThread %>
                </div>
            <% end %>
            <div id="bottom">
                <div>
                    <%= tradOf(:entirely_done_with) %>
                <a href="http://www.vim.org">Vim</a>
                    <%= tradOf(:and) %> 
                <a href="http://nanoc.stoneship.org">nanoc</a>
                </div>
                <div>
                <a href="/Scratch/<%=language%>/validation/">Validation</a> 
                <a href="http://validator.w3.org/check?uri=referer"> [xhtml] </a>
                .
                <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3"> [css] </a>
                .
                <a href="http://validator.w3.org/feed/check.cgi?url=http%3A//yannesposito.com/Scratch/<%=language%>/blog/feed/feed.xml">[rss]</a>
                </div>
                <div>
                    <%=tradOf(:copyright) %>
                </div>
                <div id="lastmod">
                    <%=tradOf(:last_modified)%>: <%= @item.mtime.strftime(@config[:dateFormat][language.intern]) %> 
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</body>
</html>
