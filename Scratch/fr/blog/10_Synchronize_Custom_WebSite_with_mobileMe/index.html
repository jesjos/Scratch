<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        
        
        <meta name="keywords" content="Apple, mobileme, WebDav, synchronisation, zsh, script">
        
        <link rel="shortcut icon" type="image/x-icon" href="/Scratch/img/favicon.ico" />
        <link rel="stylesheet" type="text/css" href="/Scratch/assets/css/main.css" />
        <link rel="stylesheet" type="text/css" href="/Scratch/css/twilight.css" />
        <link rel="stylesheet" type="text/css" href="/Scratch/css/idc.css" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/yannespositocomfr"/>
        
        <link rel="alternate" lang="fr" xml:lang="fr" title="Héberger son site personnel sur le site mobileMe" type="text/html" hreflang="fr" href="/Scratch/fr/blog/10_Synchronize_Custom_WebSite_with_mobileMe/" /> 
        <link rel="alternate" lang="en" xml:lang="en" title="Synchronize Custom WebSite with mobileMe" type="text/html" hreflang="en" href="/Scratch/en/blog/10_Synchronize_Custom_WebSite_with_mobileMe/" /> 
        <script type="text/javascript" src="/Scratch/js/jquery-1.3.1.min.js"></script>
        <script type="text/javascript" src="/Scratch/js/jquery.cookie.js"></script>
        <script type="text/javascript" src="/Scratch/js/index.js"></script>
        <!--[if lt IE 9]>
        <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
        <![endif]-->
        <!-- < % if containMaths %>
        <script type="text/javascript" src="/Scratch/js/MathJax/MathJax.js"></script>
        < % end %>
        -->
        <title>Héberger son site personnel sur le site mobileMe</title>
    </head>
    <body lang="fr" class="article">
        <script type="text/javascript">// <![CDATA[
            document.write('<div id="blackpage"><img src="/Scratch/img/loading.gif" alt="Chargement en cours..."/></div>');
            // ]]>
        </script>

        <div id="content">

            <div id="choix"> 
                <div class="return"><a href="#entete">&darr; Menu &darr;</a></div>
                <div id="choixlang">
                    <a href="/Scratch/en/blog/10_Synchronize_Custom_WebSite_with_mobileMe/" onclick="setLanguage('en')">in English</a>
                </div>
                <div class="flush"></div>
            </div>
            <div id="titre">
                <h1>
                    Héberger son site personnel sur le site mobileMe
                </h1>
                
            </div>
            <div class="flush"></div>

            

            

            <div class="flush"></div>
            <div id="afterheader">
                <div class="corps">
                    <h1 class="first" id="mise--jour-du-small28102009small">mise à jour du <small>28/10/2009</small></h1>

<p>J&rsquo;ai mis à jour mon script <a href="/Scratch/fr/blog/2009-10-28-custom-website-synchronisation-with-mobileme--2-">avec une version incrémentale</a> bien plus pratique.
En plus depuis l&rsquo;écriture de cet article Apple<small>&copy;</small> semble avoir nettement amélioré la vitesse de ses serveurs en Europe.</p>


</div>

<div class="corps">


<h1 class="first" id="webdav-terror">WebDav terror</h1>

<p>En France l&rsquo;iDisk d&rsquo;Apple<small>&copy;</small> est très lent. La vitesse d&rsquo;upload me rapelle l&rsquo;époque des modem 56k, c&rsquo;est dire. La plupart du temps les opérations telles que lister le contenu d&rsquo;un répertoire prennent au moins 30 secondes (pour 15 éléments). Renommer un répertoire échoue presque systématiquement.</p>

<p>Apple<small>&copy;</small> utilise des serveurs WebDav pour héberger les fichiers. Le protocole fonctionne sur le port 80 (comme http). Je me suis rendu compte qu&rsquo;utiliser WebDav via https fontionne bien mieux (2 à 3 fois plus rapide avec moins d&rsquo;erreurs). Mais, ça reste quand même très lent et insuffisant.</p>

<p>J&rsquo;<em>uploade</em> mes fichiers à partir de mon Mac et de temps en temps à partir d&rsquo;un PC sous Ubuntu (iDisk monté avec webdavfs).</p>

<h1 id="synchroniser-de-faon-sre">Synchroniser de façon sûre</h1>

<p>Voici le script que j&rsquo;utilise pour synchroniser mon site web (non créé avec iWeb<small>&copy;</small>) avec le maximum de sécurité. Chaque opération est répétée jusqu&rsquo;à ce qu&rsquo;elle fonctionne.</p>

<p>Les idées sont&nbsp;: </p>

<ul>
  <li>Synchroniser vers un répertoire temporaire sur le serveur distant, puis &ldquo;swapper&rdquo; les noms des répertoires. Ainsi le site ne reste indisponible que le temps du &ldquo;swap&rdquo; du nom des deux répertoires.</li>
  <li>Réitérer toutes les opérations jusqu&rsquo;à ce qu&rsquo;elle aient réussi (par exemple pour le renommage)</li>
</ul>

<p>Jusqu&rsquo;ici j&rsquo;utilise <code>rsync</code> qui n&rsquo;est en fait pas plus efficace qu&rsquo;une simple copie <code>cp</code> avec WebDav. Je devrais utiliser une méthode pour mémoriser les changements entre chaque publication.</p>

<p>En réalité quand je suis sur mon Mac j&rsquo;utilise <a href="http://www.panic.com/transmit">Transmit</a> qui est vraiment très bien et surtout beaucoup plus efficace que le finder pour synchroniser des fichiers. Ensuite, je ne fait que le &ldquo;swap&rdquo; des répertoires.</p>

<p>Mon script prend un paramètre <code>-s</code> pour ne faire que le &ldquo;swap&rdquo;. Il prend aussi une option <code>-a</code> pour envoyer le fichier <code>index.html</code> qui va rediriger vers ma nouvelle page principale (iWeb<small>&copy;</small> à la fâcheuse habitude de le remplacer).</p>

<p>Pour utiliser le script vous devriez remplacer la valeur de la variable <code>mobileMeUser</code> par votre nom d&rsquo;utilisateur mobileMe<small>&copy;</small>.</p>

<div class="fr">
<div class="code"><div class="file"><a href="/Scratch/fr/blog/10_Synchronize_Custom_WebSite_with_mobileMe/code/publish"> &#x27A5; publish </a></div><div class="withfile">
<pre class="twilight">
<span class="Comment"><span class="Comment">#</span>!/usr/bin/env zsh</span>

<span class="Comment"><span class="Comment">#</span> Script synchronisant le site sur me.com</span>
<span class="Comment"><span class="Comment">#</span> normalement, le site est indisponible le moins de temps possible</span>
<span class="Comment"><span class="Comment">#</span> le temps de deux renommages de répertoire</span>

mobileMeUser=<span class="String"><span class="String">&quot;</span>yann.esposito<span class="String">&quot;</span></span>
siteName=<span class="String"><span class="String">&quot;</span>siteName<span class="String">&quot;</span></span>

<span class="Comment"><span class="Comment">#</span> Depending of my hostname the </span>
<span class="Keyword">if</span> [[ <span class="String"><span class="String">$(</span>hostname<span class="String">)</span></span> <span class="Keyword">==</span> <span class="String"><span class="String">'</span>ubuntu<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    iDisk=<span class="String"><span class="String">'</span>/mnt/iDisk<span class="String">'</span></span>
<span class="Keyword">else</span>
    iDisk=<span class="String"><span class="String">&quot;</span>/Volumes/<span class="StringVariable"><span class="StringVariable">$</span>mobileMeUser</span><span class="String">&quot;</span></span>
<span class="Keyword">fi</span>

root=<span class="Variable"><span class="Variable">$</span>HOME</span>/Sites/<span class="Variable"><span class="Variable">$</span>siteName</span>
destRep=<span class="Variable"><span class="Variable">$</span>iDisk</span>/Web/Sites/<span class="Variable"><span class="Variable">$</span>siteName</span>

[[ <span class="Keyword">!</span> -d <span class="Variable"><span class="Variable">$</span>root</span> ]] <span class="Keyword">&amp;&amp;</span> { 
    print -- <span class="String"><span class="String">&quot;</span><span class="StringVariable"><span class="StringVariable">$</span>root</span> n'existe pas&nbsp;; vérifiez la conf<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span><span class="Keyword">;</span> 
    exit 1 
}

[[ <span class="Keyword">!</span> -d <span class="Variable"><span class="Variable">$</span>destRep</span> ]] <span class="Keyword">&amp;&amp;</span> { 
    print -- <span class="String"><span class="String">&quot;</span><span class="StringVariable"><span class="StringVariable">$</span>destRep</span> n'existe pas, veuillez remonter le FS<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span><span class="Keyword">;</span> 
    exit 1 
}

<span class="Keyword">if</span> [[ <span class="Variable"><span class="Variable">$</span>1</span> <span class="Keyword">==</span> <span class="String"><span class="String">'</span>-h<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    print -- <span class="String"><span class="String">&quot;</span>usage: <span class="StringVariable"><span class="StringVariable">$</span>0</span>:h [-h|-a|-s]<span class="String">&quot;</span></span>
    print -- <span class="String"><span class="String">&quot;</span>  -a sychronise aussi l'index<span class="String">&quot;</span></span>
    print -- <span class="String"><span class="String">&quot;</span>  -h affiche l'aide<span class="String">&quot;</span></span>
    print -- <span class="String"><span class="String">&quot;</span>  -s swappe simplement les répertoires<span class="String">&quot;</span></span>
<span class="Keyword">fi</span>

<span class="Keyword">if</span> [[ <span class="Variable"><span class="Variable">$</span>1</span> <span class="Keyword">==</span> <span class="String"><span class="String">'</span>-a<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    print -- <span class="String"><span class="String">&quot;</span>Synchronisation de l'index (<span class="StringVariable"><span class="StringVariable">${</span>destRep:h<span class="StringVariable">}</span></span>)<span class="String">&quot;</span></span>
    rsync -av <span class="Variable"><span class="Variable">$</span>root</span>/index.html <span class="Variable"><span class="Variable">${</span>destRep:h<span class="Variable">}</span></span>/index.html
<span class="Keyword">fi</span>

print -- <span class="String"><span class="String">&quot;</span>Root = <span class="StringVariable"><span class="StringVariable">$</span>root</span><span class="String">&quot;</span></span>
print -- <span class="String"><span class="String">&quot;</span>Dest = <span class="StringVariable"><span class="StringVariable">$</span>destRep</span><span class="String">&quot;</span></span>

<span class="Keyword">if</span> [[ <span class="Keyword">!</span> <span class="Variable"><span class="Variable">$</span>1</span> = <span class="String"><span class="String">'</span>-s<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    [[ <span class="Keyword">!</span> -d <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp ]] <span class="Keyword">&amp;&amp;</span> mkdir <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp
    print -P -- <span class="String"><span class="String">&quot;</span>%B[Sync =&gt; tmp]%b<span class="String">&quot;</span></span>
    result=1
    essai=1
    <span class="Keyword">while</span> (( <span class="Variable"><span class="Variable">$</span>result</span> <span class="Keyword">&gt;</span> 0 ))<span class="Keyword">;</span> <span class="Keyword">do</span>
        rsync -arv <span class="Variable"><span class="Variable">$</span>root</span>/Scratch/ <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp
        result=<span class="Variable"><span class="Variable">$</span>?</span>
        <span class="Keyword">if</span> (( <span class="Variable"><span class="Variable">$</span>result</span> <span class="Keyword">&gt;</span> 0 ))<span class="Keyword">;</span> <span class="Keyword">then</span>
            print -P -- <span class="String"><span class="String">&quot;</span>%BEchec du rsync%b (essai n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
        <span class="Keyword">fi</span>
        ((essai++))
    <span class="Keyword">done</span>
<span class="Keyword">fi</span>

<span class="Comment"><span class="Comment">#</span> SWAP</span>
print -P -- <span class="String"><span class="String">&quot;</span>%B[Swap des Répertoires (tmp &lt;=&gt; target)]%b<span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ -e <span class="Variable"><span class="Variable">$</span>destRep</span>.old ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    print -n -- <span class="String"><span class="String">&quot;</span>suppression de <span class="StringVariable"><span class="StringVariable">$</span>destRep</span>.old<span class="String">&quot;</span></span>
    <span class="Keyword">if</span> ((essai<span class="Keyword">&gt;</span>1))<span class="Keyword">;</span> <span class="Keyword">then</span> 
        print <span class="String"><span class="String">&quot;</span> (essai n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>)<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
        print
    <span class="Keyword">fi</span>
    ((essai++))
    <span class="Constant">\r</span>m -rf <span class="Variable"><span class="Variable">$</span>destRep</span>.old
<span class="Keyword">done</span>

print -- <span class="String"><span class="String">&quot;</span>  renommage du repertoire sandard vers le .old<span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ -e <span class="Variable"><span class="Variable">$</span>destRep</span> ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    mv <span class="Variable"><span class="Variable">$</span>destRep</span> <span class="Variable"><span class="Variable">$</span>destRep</span>.old 
    ((<span class="Variable"><span class="Variable">$</span>?</span>)) <span class="Keyword">&amp;&amp;</span> print -- <span class="String"><span class="String">&quot;</span>Echec du renommage (essai n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
    ((essai++))
<span class="Keyword">done</span>

print -- <span class="String"><span class="String">&quot;</span>  renommage du repertoire tmp (nouveau) vers le standard<span class="String">&quot;</span></span>
print -P -- <span class="String"><span class="String">&quot;</span>  %BSite Indisponible%b <span class="String"><span class="String">$(</span>date<span class="String">)</span></span><span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ <span class="Keyword">!</span> -e <span class="Variable"><span class="Variable">$</span>destRep</span> ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    mv <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp <span class="Variable"><span class="Variable">$</span>destRep</span>
    ((<span class="Variable"><span class="Variable">$</span>?</span>)) <span class="Keyword">&amp;&amp;</span> print -P -- <span class="String"><span class="String">&quot;</span>%B[Site Indisponible]%b(essai n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>) Echec du renommage (mv <span class="StringVariable"><span class="StringVariable">$</span>destRep</span>.tmp <span class="StringVariable"><span class="StringVariable">$</span>destRep</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
    ((essai++))
<span class="Keyword">done</span>

print -P -- <span class="String"><span class="String">&quot;</span>\t===\t%BSITE DISPONIBLE%b\t===<span class="String">&quot;</span></span>

print -- <span class="String"><span class="String">&quot;</span>  renommage du repertoire old vers le tmp<span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ <span class="Keyword">!</span> -e <span class="Variable"><span class="Variable">$</span>destRep</span> ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    mv <span class="Variable"><span class="Variable">$</span>destRep</span>.old <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp
    ((<span class="Variable"><span class="Variable">$</span>?</span>)) <span class="Keyword">&amp;&amp;</span> print -P -- <span class="String"><span class="String">&quot;</span>Echec du renommage n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span><span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
    ((essai++))
<span class="Keyword">done</span>

print -P -- <span class="String"><span class="String">&quot;</span>  publication terminée<span class="String">&quot;</span></span>
</pre>
</div></div>
</div>

<div class="en">
<div class="code"><div class="file"><a href="/Scratch/fr/blog/10_Synchronize_Custom_WebSite_with_mobileMe/code/publish"> &#x27A5; publish </a></div><div class="withfile">
<pre class="twilight">
<span class="Comment"><span class="Comment">#</span>!/usr/bin/env zsh</span>

<span class="Comment"><span class="Comment">#</span> Author: Yann Esposito</span>
<span class="Comment"><span class="Comment">#</span>   Mail: yann.esposito@gmail.com</span>
<span class="Comment"><span class="Comment">#</span> Synchronize with &quot;mobileMe&quot; iDisk account.</span>

mobileMeUser=<span class="String"><span class="String">&quot;</span>firstname.lastname<span class="String">&quot;</span></span>
siteName=<span class="String"><span class="String">&quot;</span>siteName<span class="String">&quot;</span></span>

<span class="Comment"><span class="Comment">#</span> Depending of my hostname the </span>
<span class="Keyword">if</span> [[ <span class="String"><span class="String">$(</span>hostname<span class="String">)</span></span> <span class="Keyword">==</span> <span class="String"><span class="String">'</span>ubuntu<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    iDisk=<span class="String"><span class="String">'</span>/mnt/iDisk<span class="String">'</span></span>
<span class="Keyword">else</span>
    iDisk=<span class="String"><span class="String">&quot;</span>/Volumes/<span class="StringVariable"><span class="StringVariable">$</span>mobileMeUser</span><span class="String">&quot;</span></span>
<span class="Keyword">fi</span>

root=<span class="Variable"><span class="Variable">$</span>HOME</span>/Sites/<span class="Variable"><span class="Variable">$</span>siteName</span>
destRep=<span class="Variable"><span class="Variable">$</span>iDisk</span>/Web/Sites/<span class="Variable"><span class="Variable">$</span>siteName</span>

[[ <span class="Keyword">!</span> -d <span class="Variable"><span class="Variable">$</span>root</span> ]] <span class="Keyword">&amp;&amp;</span> { 
    print -- <span class="String"><span class="String">&quot;</span><span class="StringVariable"><span class="StringVariable">$</span>root</span> does not exist&nbsp;; please verify the configuration (<span class="StringVariable"><span class="StringVariable">$</span>0</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span><span class="Keyword">;</span> 
    exit 1 
}

[[ <span class="Keyword">!</span> -d <span class="Variable"><span class="Variable">$</span>destRep</span> ]] <span class="Keyword">&amp;&amp;</span> { 
    print -- <span class="String"><span class="String">&quot;</span><span class="StringVariable"><span class="StringVariable">$</span>destRep</span> does not exist, please mount the filesystem<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span><span class="Keyword">;</span> 
    exit 1 
}

<span class="Keyword">if</span> [[ <span class="Variable"><span class="Variable">$</span>1</span> <span class="Keyword">==</span> <span class="String"><span class="String">'</span>-h<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    print -- <span class="String"><span class="String">&quot;</span>usage: <span class="StringVariable"><span class="StringVariable">$</span>0</span>:h [-h|-a|-s]<span class="String">&quot;</span></span>
    print -- <span class="String"><span class="String">&quot;</span>  -a sychronize primary index<span class="String">&quot;</span></span>
    print -- <span class="String"><span class="String">&quot;</span>  -h show this help<span class="String">&quot;</span></span>
    print -- <span class="String"><span class="String">&quot;</span>  -s only swap directories<span class="String">&quot;</span></span>
<span class="Keyword">fi</span>

<span class="Keyword">if</span> [[ <span class="Variable"><span class="Variable">$</span>1</span> <span class="Keyword">==</span> <span class="String"><span class="String">'</span>-a<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    print -- <span class="String"><span class="String">&quot;</span>Index synchronisation (<span class="StringVariable"><span class="StringVariable">${</span>destRep:h<span class="StringVariable">}</span></span>)<span class="String">&quot;</span></span>
    rsync -av <span class="Variable"><span class="Variable">$</span>root</span>/index.html <span class="Variable"><span class="Variable">${</span>destRep:h<span class="Variable">}</span></span>/index.html
<span class="Keyword">fi</span>

print -- <span class="String"><span class="String">&quot;</span>Root = <span class="StringVariable"><span class="StringVariable">$</span>root</span><span class="String">&quot;</span></span>
print -- <span class="String"><span class="String">&quot;</span>Dest = <span class="StringVariable"><span class="StringVariable">$</span>destRep</span><span class="String">&quot;</span></span>

<span class="Keyword">if</span> [[ <span class="Keyword">!</span> <span class="Variable"><span class="Variable">$</span>1</span> = <span class="String"><span class="String">'</span>-s<span class="String">'</span></span> ]]<span class="Keyword">;</span> <span class="Keyword">then</span>
    [[ <span class="Keyword">!</span> -d <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp ]] <span class="Keyword">&amp;&amp;</span> mkdir <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp
    print -P -- <span class="String"><span class="String">&quot;</span>%B[Sync =&gt; tmp]%b<span class="String">&quot;</span></span>
    result=1
    essai=1
    <span class="Keyword">while</span> (( <span class="Variable"><span class="Variable">$</span>result</span> <span class="Keyword">&gt;</span> 0 ))<span class="Keyword">;</span> <span class="Keyword">do</span>
        rsync -arv <span class="Variable"><span class="Variable">$</span>root</span>/Scratch/ <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp
        result=<span class="Variable"><span class="Variable">$</span>?</span>
        <span class="Keyword">if</span> (( <span class="Variable"><span class="Variable">$</span>result</span> <span class="Keyword">&gt;</span> 0 ))<span class="Keyword">;</span> <span class="Keyword">then</span>
            print -P -- <span class="String"><span class="String">&quot;</span>%Brsync failed%b (try n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
        <span class="Keyword">fi</span>
        ((essai++))
    <span class="Keyword">done</span>
<span class="Keyword">fi</span>

<span class="Comment"><span class="Comment">#</span> SWAP</span>
print -P -- <span class="String"><span class="String">&quot;</span>%B[Directory Swap (tmp &lt;=&gt; target)]%b<span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ -e <span class="Variable"><span class="Variable">$</span>destRep</span>.old ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    print -n -- <span class="String"><span class="String">&quot;</span>remove <span class="StringVariable"><span class="StringVariable">$</span>destRep</span>.old<span class="String">&quot;</span></span>
    <span class="Keyword">if</span> ((essai<span class="Keyword">&gt;</span>1))<span class="Keyword">;</span> <span class="Keyword">then</span> 
        print <span class="String"><span class="String">&quot;</span> (try n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>)<span class="String">&quot;</span></span>
    <span class="Keyword">else</span>
        print
    <span class="Keyword">fi</span>
    ((essai++))
    <span class="Constant">\r</span>m -rf <span class="Variable"><span class="Variable">$</span>destRep</span>.old
<span class="Keyword">done</span>

print -- <span class="String"><span class="String">&quot;</span>  renommage du repertoire sandard vers le .old<span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ -e <span class="Variable"><span class="Variable">$</span>destRep</span> ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    mv <span class="Variable"><span class="Variable">$</span>destRep</span> <span class="Variable"><span class="Variable">$</span>destRep</span>.old 
    ((<span class="Variable"><span class="Variable">$</span>?</span>)) <span class="Keyword">&amp;&amp;</span> print -- <span class="String"><span class="String">&quot;</span>Failed to rename (try n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
    ((essai++))
<span class="Keyword">done</span>

print -- <span class="String"><span class="String">&quot;</span>  renaming folder tmp (new) to the standard one<span class="String">&quot;</span></span>
print -P -- <span class="String"><span class="String">&quot;</span>  %BThe WebSite isn't working%b <span class="String"><span class="String">$(</span>date<span class="String">)</span></span><span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ <span class="Keyword">!</span> -e <span class="Variable"><span class="Variable">$</span>destRep</span> ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    mv <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp <span class="Variable"><span class="Variable">$</span>destRep</span>
    ((<span class="Variable"><span class="Variable">$</span>?</span>)) <span class="Keyword">&amp;&amp;</span> print -P -- <span class="String"><span class="String">&quot;</span>%B[WebSite not working]%b(try n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span>) Failed to rename (mv <span class="StringVariable"><span class="StringVariable">$</span>destRep</span>.tmp <span class="StringVariable"><span class="StringVariable">$</span>destRep</span>)<span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
    ((essai++))
<span class="Keyword">done</span>

print -P -- <span class="String"><span class="String">&quot;</span>\t===\t%BWEBSITE SHOULD WORK NOW%b\t===<span class="String">&quot;</span></span>

print -- <span class="String"><span class="String">&quot;</span>  rename old folder to tmp folder<span class="String">&quot;</span></span>
essai=1
<span class="Keyword">while</span> [[ <span class="Keyword">!</span> -e <span class="Variable"><span class="Variable">$</span>destRep</span> ]]<span class="Keyword">;</span> <span class="Keyword">do</span>
    mv <span class="Variable"><span class="Variable">$</span>destRep</span>.old <span class="Variable"><span class="Variable">$</span>destRep</span>.tmp
    ((<span class="Variable"><span class="Variable">$</span>?</span>)) <span class="Keyword">&amp;&amp;</span> print -P -- <span class="String"><span class="String">&quot;</span>Failed to rename n°<span class="StringVariable"><span class="StringVariable">$</span>essai</span><span class="String">&quot;</span></span> <span class="Keyword">&gt;&amp;2</span>
    ((essai++))
<span class="Keyword">done</span>

print -P -- <span class="String"><span class="String">&quot;</span>  Publish terminated<span class="String">&quot;</span></span>
</pre>
</div></div>
</div>

                </div>
            
                

                <div id="choixrss">
                    <a id="rss" href="http://feeds.feedburner.com/yannespositocomfr">
                        s'abonner
                    </a>
                </div>
                <script type="text/javascript">
                    $(document).ready(function(){ 
                            $('#comment').hide(); 
                            $('#clickcomment').click(showComments); 
                        });
                    function showComments() {
                        $('#comment').show();
                        $('#clickcomment').fadeOut();
                    }
                    document.write('<div id="clickcomment">Commentaires</div>');
                </script>
                <div class="flush"></div>
                <div class="corps" id="comment">
                    <h2 class="first">commentaires</h2>
                    <noscript>
                        Vous devez activer javascript pour commenter.
                    </noscript>
                    
    <script type="text/javascript">
    var idcomments_acct = 'a307f0044511ff1b5cfca573fc0a52e7';
    var idcomments_post_id = '/Scratch/fr/blog/10_Synchronize_Custom_WebSite_with_mobileMe/';
    var idcomments_post_url = 'http://yannesposito.com/Scratch/fr/blog/10_Synchronize_Custom_WebSite_with_mobileMe/';
    </script>
    <span id="IDCommentsPostTitle" style="display:none"></span>
    <script type='text/javascript' src='/Scratch/js/genericCommentWrapperV2.js'></script>
    
                </div>

            <div id="entete" class="corps_spaced">
                <div id="liens">
                    <ul><li><a href="/Scratch/fr/">Bienvenue</a></li>
<li><a href="/Scratch/fr/blog/">Blog</a></li>
<li><a href="/Scratch/fr/softwares/">Softwares</a></li>
<li><a href="/Scratch/fr/about/">À propos</a></li></ul>
                </div>
                <div class="flush"></div>
                <hr/>
                <div id="next_before_articles">
                    <div id="previous_articles">
                        articles précédents
                        
                        <div class="previous_article">
                            <a href="/Scratch/fr/blog/09_Why_I_didn-t_keep_whosamung-us/"><span class="nicer">«</span>&nbsp;Pourquoi je n'ai pas conservé whos.amung.us</a>
                        </div>
                        
                        
                        <div class="previous_article">
                            <a href="/Scratch/fr/blog/08_Configure_ssh_to_listen_the_port_443_on_Snow_Leopard/"><span class="nicer">«</span>&nbsp;ssh sur le port 443 avec Snow Leopard</a>
                        </div>
                        
                        
                        <div class="previous_article">
                            <a href="/Scratch/fr/blog/07_Screensaver_compilation_option_for_Snow_Leopard/"><span class="nicer">«</span>&nbsp;Compilation d'économiseur d'écran sous Snow Leopard<small>&copy;</small></a>
                        </div>
                        
                        
                    </div>
                    <div id="next_articles">
                        articles suivants
                        
                        <div class="next_article">
                            <a href="/Scratch/fr/blog/11_Load_Disqus_Asynchronously/">Load Disqus Asynchronously [en]&nbsp;<span class="nicer">»</span></a>
                        </div>
                        
                        
                        <div class="next_article">
                            <a href="/Scratch/fr/blog/2009-09-replace-all-except-some-part/">Remplacer tout sauf une partie&nbsp;<span class="nicer">»</span></a>
                        </div>
                        
                        
                        <div class="next_article">
                            <a href="/Scratch/fr/blog/2009-09-jQuery-Tag-Cloud/">jQuery Tag Cloud [en]&nbsp;<span class="nicer">»</span></a>
                        </div>
                        
                        
                    </div>
                    <div class="flush"></div>
                </div>
            </div>


            <div id="bottom">
                <div>
                    <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.fr">Droits de reproduction ©, Yann Esposito</a>
                </div>
                <div id="lastmod">
                    Écrit le : 11/09/2009
                    modifié le : 30/05/2011 
                </div>
                <div>
                    Site entièrement réalisé avec
                    <a href="http://www.vim.org">Vim</a>
                    et 
                    <a href="http://nanoc.stoneship.org">nanoc</a>
                </div>
                <div>
                    <a href="/Scratch/fr/validation/">Validation</a> 
                    <a href="http://validator.w3.org/check?uri=referer"> [xhtml] </a>
                    .
                    <a href="http://jigsaw.w3.org/css-validator/check/referer?profile=css3"> [css] </a>
                    .
                    <a href="http://validator.w3.org/feed/check.cgi?url=http%3A//yannesposito.com/Scratch/fr/blog/feed/feed.xml">[rss]</a>
                </div>
            </div>
            <div class="clear"></div>
        </div>
        <script type="text/javascript">
        var clicky = { log: function(){ return; }, goal: function(){ return; }};
        var clicky_site_id = 66374971;
        (function() {
              var s = document.createElement('script');
              s.type = 'text/javascript';
              s.async = true;
              s.src = ( document.location.protocol == 'https:' ? 'https://static.getclicky.com/js' : 'http://static.getclicky.com/js' );
              ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s );
        })();
</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="http://in.getclicky.com/66374971ns.gif" /></p></noscript>
    
    </body>
</html>